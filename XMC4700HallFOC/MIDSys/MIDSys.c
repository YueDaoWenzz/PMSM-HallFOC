/****************************************************************************
*    Filename:     MIDSys.c
*    IDE:          DAVE_3.1.2
*    MCU:          XMC45OO
*
*    Revision History:
*    -------------------------------------------------------------------------
*    VXXX       2013-1-22    Created
*
*    Support :  IFCN.MCU@Infineon.com
*
*    Copyright (c) Infineon Semiconductor 2012. All Rights Reserved.
*****************************************************************************/


/*****************************************************************************
 *    Include Files
 *****************************************************************************/
#include <XMC1300.h>
#include "MIDSys.h"

/*****************************************************************************
*     Macro Definitions
*****************************************************************************/


/*****************************************************************************
*     Local Type Definitions
*****************************************************************************/


/*****************************************************************************
*     Static(Local) Variable Definitions
*****************************************************************************/


/*****************************************************************************
*     Local Function Declarations
*****************************************************************************/


/*****************************************************************************
*     Global Variable Definitions
*****************************************************************************/


/*****************************************************************************
 *    Global Function Definitions
 *****************************************************************************/


/*****************************************************************************
*     Variable setting for testing, delete it when release
*****************************************************************************/


/*****************************************************************************
 * Function:      void  XXX_vInit(void)
 * Description:   Initialize the XXX Module
 *                (Please add more details)
 * Caveats:       2013-1-22
 *                test only (Please add more details)
 *****************************************************************************/
void MIDSys_Init(void)
{

    //-------------------------------------------------------------------------
    // Step 1:  XXX 
	//
    //-------------------------------------------------------------------------
    Get_Current_Init();
    //-------------------------------------------------------------------------
    // Step 2:  XXX 
	//
    //-------------------------------------------------------------------------
    Get_Angle_Init();
    //-------------------------------------------------------------------------
    // Step 3:  XXX 
	//          ---RM1.1 PageXXX
    //-------------------------------------------------------------------------
    Get_Speed_Init();
    //-------------------------------------------------------------------------
    // Step 4:  XXX 
	//          ---RM1.1 PageXXX
    //-------------------------------------------------------------------------

    //-------------------------------------------------------------------------
    // Step 5:  XXX 
	//          ---RM1.1 PageXXX
    //-------------------------------------------------------------------------

    //-------------------------------------------------------------------------
    // Step 6:  XXX 
	//          ---RM1.1 PageXXX
    //-------------------------------------------------------------------------

    //-------------------------------------------------------------------------
    // Step 7:  XXX 
	//          ---RM1.1 PageXXX
    //-------------------------------------------------------------------------

    //-------------------------------------------------------------------------
    // Step 8:  XXX 
	//          ---RM1.1 PageXXX
    //-------------------------------------------------------------------------

    //-------------------------------------------------------------------------
    // Step 9:  XXX 
	//          ---RM1.1 PageXXX
    //-------------------------------------------------------------------------

    //-------------------------------------------------------------------------
    // Step 10:  XXX 
	//          ---RM1.1 PageXXX
    //-------------------------------------------------------------------------



}

void Motor_Start(void)
{

		Initialize_PID_parameters();
    Foc16.Instruction_in=0;

		PWM_ON;
		POSIF0->MCSM	=	0x0333;							//多通道状态
    POSIF0->MCMS	|=	0x01;							//shadow transfer

		System_State_Flags.START_F=1;
		System_State_Flags.ESTIMATOR_ERROR_F=0;
}
void Motor_Stop(void)
{
	POSIF0->MCSM	=	0;								//多通道状态
  POSIF0->MCMS	|=	0x04;							//shadow transfer

	PWM_OFF;
	System_State_Flags.START_F=0;
	
	t_stop=0;
	t_stall=0;
	t_inc=0;
	t_low=0;
	Adjust_now=0;
	Foc16.Instruction_in=0;

}
