/****************************************************************************
*    Filename:     GetADCInputs.c
*    IDE:          DAVE_3.1.2
*    MCU:          XMC45OO
*
*    Revision History:
*    -------------------------------------------------------------------------
*    VXXX       2013-1-16    Created
*
*    Support :  IFCN.MCU@Infineon.com
*
*    Copyright (c) Infineon Semiconductor 2012. All Rights Reserved.
*****************************************************************************/


/*****************************************************************************
 *    Include Files
 *****************************************************************************/
#include <XMC1300.h>
#include "GetADCInputs.h"

/*****************************************************************************
*     Macro Definitions
*****************************************************************************/


/*****************************************************************************
*     Local Type Definitions
*****************************************************************************/


/*****************************************************************************
*     Static(Local) Variable Definitions
*****************************************************************************/


/*****************************************************************************
*     Local Function Declarations
*****************************************************************************/


/*****************************************************************************
*     Global Variable Definitions
*****************************************************************************/


/*****************************************************************************
 *    Global Function Definitions
 *****************************************************************************/
 /*
Iu====P2.11====G1CH3  +  Iv====P2.10=====G0Ch3
Iw====P2.3=====G1CH5
EMFW==P2.8=====G1CH0  +		EMFV==P2.6======G0CH0
UDC===P2.4=====G1CH6
POT===P2.5=====G1CH7	+		EMFU==P2.2====G0CH7
*/

int16_t  Read_POT(void)  //电位器
{
			int16_t	POT_result;
	
			POT_result	=	(VADC_G1->RES[7] & 0x0fff);
	
			if(POT_result>1024){POT_result-=1024;}  //减去基值
			else{POT_result=0;}   

			if(POT_result>=2048)  //最大值
			{
				POT_result=2048;
			}
			POT_result <<=1;
			return  ((int16_t)POT_result);
       
}
int16_t  Get_POT(void)  //通过电位器来获取运行状态与给定
{
			int16_t	POT_result;
			POT_result	=	(VADC_G1->RES[6] & 0x0fff);
      if (POT_result <= Ref_limit_min )
      {
          Stop_Cnt++;
          if(Stop_Cnt >=100)
          {
            System_State_Flags.STOP_F = 1;
            POT_result = 0;
          }            
      }
      else
      {
         System_State_Flags.STOP_F = 0;
         Stop_Cnt = 0;//停机变量清零
      }
  
			return  ((int16_t)POT_result);
       
}

